<?php
require_once 'config.php';

// Проверка авторизации
if (!isset($_SESSION['loggedin']) || $_SESSION['loggedin'] !== true) {
    header('Location: ' . ADMIN_PATH . '/admin_login.php');
    exit;
}

// Увеличим лимиты выполнения
ini_set('max_execution_time', 120);
ini_set('memory_limit', '256M');

// Включаем отладку
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// Функция для очистки текста от невидимых символов
function cleanText($text) {
    // Удаляем управляющие символы (кроме \n, \r, \t)
    $text = preg_replace('/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/u', '', $text);
    return $text;
}

// Функция для форматирования знаковой диаграммы
function formatSignDiagram($solution) {
    // Заменяем ">" на LaTeX-стрелку с разделителями
    $solution = preg_replace('/> x/', '\( \rightarrow \) x', $solution);
    return $solution;
}

// Данные задач (54 задачи)
$tasks = [
    [
        'problem' => 'Найдите точку максимума функции \( y = x^3 - 12x^2 + 36x + 1 \).',
        'solution' => "Производная: \( y' = 3x^2 - 24x + 36 \).  \nКритические точки: \( 3x^2 - 24x + 36 = 0 \Rightarrow x^2 - 8x + 12 = 0 \). \( D = 64 - 48 = 16 \). \( x = \frac{8 \pm 4}{2} \Rightarrow x = 2, 6 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = 36 > 0 \).  \n\( x = 4 \): \( y' = 48 - 96 + 36 = -12 < 0 \).  \n\( x = 7 \): \( y' = 147 - 168 + 36 = 15 > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n                2                  6\n```  \nВывод: При \( x = 2 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '2'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = -x^3 + 3x^2 - 2 \).',
        'solution' => "Производная: \( y' = -3x^2 + 6x \).  \nКритические точки: \( -3x^2 + 6x = 0 \Rightarrow x(-3x + 6) = 0 \Rightarrow x = 0, 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -1 \): \( y' = -3 + (-6) = -9 < 0 \).  \n\( x = 1 \): \( y' = -3 + 6 = 3 > 0 \).  \n\( x = 3 \): \( y' = -27 + 18 = -9 < 0 \).  \n```\n   -                     +                    -\n----------------*------------------*----------------> x\n                0                  2\n```  \nВывод: При \( x = 0 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '0'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = -x^5 + 8x^3 - 150x \) на отрезке \( [-2; 2] \).',
        'solution' => "Производная: \( y' = -5x^4 + 24x^2 - 150 \).  \nКритические точки: \( 5x^4 - 24x^2 + 150 = 0 \). Пусть \( t = x^2 \): \( 5t^2 - 24t + 150 = 0 \). \( D = 576 - 3000 = -2424 < 0 \), корней нет.  \nЗначения на концах:  \n\( x = -2 \): \( y = 32 - 64 + 300 = 268 \).  \n\( x = 2 \): \( y = -32 + 64 - 300 = -268 \). Максимум: 268.  \nПоведение: \( y' \) при \( x = 0 \): \( y' = -150 < 0 \), функция убывает.",
        'answer' => '268'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = -x^3 + 27x \) на отрезке \( [-4; 4] \).',
        'solution' => "Производная: \( y' = -3x^2 + 27 \).  \nКритические точки: \( -3x^2 + 27 = 0 \Rightarrow x^2 = 9 \Rightarrow x = \pm 3 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -4 \): \( y' = -48 + 27 = -21 < 0 \).  \n\( x = 0 \): \( y' = 27 > 0 \).  \n\( x = 4 \): \( y' = -48 + 27 = -21 < 0 \).  \n```\n   -                     +                    -\n----------------*------------------*----------------> x\n               -3                  3\n```  \nЗначения функции:  \n\( x = -4 \): \( y = 64 - 108 = -44 \).  \n\( x = -3 \): \( y = 27 - 81 = -54 \).  \n\( x = 3 \): \( y = -27 + 81 = 54 \).  \n\( x = 4 \): \( y = -64 + 108 = 44 \). Максимум: 54.",
        'answer' => '54'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = -5x^2 + 14x \) на отрезке \( [-4; 2] \).',
        'solution' => "Производная: \( y' = -10x + 14 \).  \nКритическая точка: \( -10x + 14 = 0 \Rightarrow x = 1.4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = 14 > 0 \).  \n\( x = 2 \): \( y' = -20 + 14 = -6 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n               1.4\n```  \nЗначения функции:  \n\( x = -4 \): \( y = -80 - 56 = -136 \).  \n\( x = 1.4 \): \( y = -5(1.96) + 19.6 = 9.8 \).  \n\( x = 2 \): \( y = -20 + 28 = 8 \). Минимум: -136.",
        'answer' => '-136'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = -x^3 + 3x^2 + 8 \) на отрезке \( [0; 3] \).',
        'solution' => "Производная: \( y' = -3x^2 + 6x \).  \nКритические точки: \( x(-3x + 6) = 0 \Rightarrow x = 0, 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -1 \): \( y' = -3 + (-6) = -9 < 0 \).  \n\( x = 1 \): \( y' = -3 + 6 = 3 > 0 \).  \n\( x = 3 \): \( y' = -27 + 18 = -9 < 0 \).  \n```\n   -                     +                    -\n----------------*------------------*----------------> x\n                0                  2\n```  \nЗначения функции:  \n\( x = 0 \): \( y = 8 \).  \n\( x = 2 \): \( y = -8 + 12 + 8 = 12 \).  \n\( x = 3 \): \( y = -27 + 27 + 8 = 8 \). Минимум: 8.",
        'answer' => '8'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = -x^3 + 3x^2 - 1 \).',
        'solution' => "Производная: \( y' = -3x^2 + 6x \).  \nКритические точки: \( x(-3x + 6) = 0 \Rightarrow x = 0, 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -1 \): \( y' = -3 - 6 = -9 < 0 \).  \n\( x = 1 \): \( y' = -3 + 6 = 3 > 0 \).  \n\( x = 3 \): \( y' = -27 + 18 = -9 < 0 \).  \n```\n   -                     +                    -\n----------------*------------------*----------------> x\n                0                  2\n```  \nВывод: При \( x = 0 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '0'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = -x^3 + 6x^2 - 3 \).',
        'solution' => "Производная: \( y' = -3x^2 + 12x \).  \nКритические точки: \( x(-3x + 12) = 0 \Rightarrow x = 0, 4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -1 \): \( y' = -3 - 12 = -15 < 0 \).  \n\( x = 2 \): \( y' = -12 + 24 = 12 > 0 \).  \n\( x = 5 \): \( y' = -75 + 60 = -15 < 0 \).  \n```\n   -                     +                    -\n----------------*------------------*----------------> x\n                0                  4\n```  \nВывод: При \( x = 4 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '4'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = x^3 - 3x^2 + 12 \) на отрезке \( [0; 8] \).',
        'solution' => "Производная: \( y' = 3x^2 - 6x \).  \nКритические точки: \( x(3x - 6) = 0 \Rightarrow x = 0, 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -1 \): \( y' = 3 + 6 = 9 > 0 \).  \n\( x = 1 \): \( y' = 3 - 6 = -3 < 0 \).  \n\( x = 3 \): \( y' = 27 - 18 = 9 > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n                0                  2\n```  \nЗначения функции:  \n\( x = 0 \): \( y = 12 \).  \n\( x = 2 \): \( y = 8 - 12 + 12 = 8 \).  \n\( x = 8 \): \( y = 512 - 192 + 12 = 332 \). Максимум: 332.",
        'answer' => '332'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^3 - 12x - 7 \) на отрезке \( [8; 50] \).',
        'solution' => "Производная: \( y' = 3x^2 - 12 \).  \nКритические точки: \( x^2 = 4 \Rightarrow x = \pm 2 \), вне отрезка.  \nЗначения на концах:  \n\( x = 8 \): \( y = 512 - 96 - 7 = 409 \).  \n\( x = 50 \): \( y = 125000 - 600 - 7 = 124393 \). Минимум: 409.  \nПоведение: \( y' \) при \( x = 8 \): \( y' = 192 - 12 = 180 > 0 \), функция возрастает.",
        'answer' => '409'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = -(x - 2)^2 (x - 5) + 10 \).',
        'solution' => "Производная: \( y' = -[2(x - 2)(x - 5) + (x - 2)^2] = -(x - 2)(3x - 12) \).  \nКритические точки: \( (x - 2)(3x - 12) = 0 \Rightarrow x = 2, 4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = -(1-2)(3-12) = -(-1)(-9) = -9 < 0 \).  \n\( x = 3 \): \( y' = -(3-2)(9-12) = -(1)(-3) = 3 > 0 \).  \n\( x = 5 \): \( y' = -(5-2)(15-12) = -(3)(3) = -9 < 0 \).  \n```\n   -                     +                    -\n----------------*------------------*----------------> x\n                2                  4\n```  \nВывод: При \( x = 4 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '4'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = (x + 2)^2 (x + 8) - 4 \).',
        'solution' => "Производная: \( y' = 2(x + 2)(x + 8) + (x + 2)^2 = (x + 2)(3x + 18) \).  \nКритические точки: \( (x + 2)(3x + 18) = 0 \Rightarrow x = -2, -6 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -7 \): \( y' = (-5)(-3) = 15 > 0 \).  \n\( x = -4 \): \( y' = (-2)(6) = -12 < 0 \).  \n\( x = 0 \): \( y' = (2)(18) = 36 > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n               -6                 -2\n```  \nВывод: При \( x = -2 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '-2'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = (10 - x)e^{x + 10} \).',
        'solution' => "Производная: \( y' = e^{x + 10}(10 - x) + e^{x + 10}(-1) = e^{x + 10}(9 - x) \).  \nКритическая точка: \( 9 - x = 0 \Rightarrow x = 9 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 8 \): \( y' = e^{18}(1) > 0 \).  \n\( x = 10 \): \( y' = e^{20}(-1) < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n                9\n```  \nВывод: При \( x = 9 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '9'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = (20 - x)e^{-x - 20} \).',
        'solution' => "Производная: \( y' = e^{-x - 20}(20 - x) + e^{-x - 20}(-1)(20 - x) = -e^{-x - 20}(21 - x) \).  \nКритическая точка: \( 21 - x = 0 \Rightarrow x = 21 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 20 \): \( y' = -e^{-40}(1) < 0 \).  \n\( x = 22 \): \( y' = -e^{-42}(-1) > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n               21\n```  \nВывод: При \( x = 21 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '21'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = (x + 5)^2 e^{-x - 8} \).',
        'solution' => "Производная: \( y' = 2(x + 5)e^{-x - 8} + (x + 5)^2(-e^{-x - 8}) = e^{-x - 8}(x + 5)(-x - 3) \).  \nКритические точки: \( (x + 5)(-x - 3) = 0 \Rightarrow x = -5, -3 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -6 \): \( y' = (-1)(-3) > 0 \).  \n\( x = -4 \): \( y' = (1)(-1) < 0 \).  \n\( x = -2 \): \( y' = (3)(1) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n               -5                 -3\n```  \nВывод: При \( x = -3 \) производная меняется с \( - \) на \( + \), это максимум.",
        'answer' => '-3'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = (x^2 - 4x + 4)e^{x + 6} \).',
        'solution' => "Производная: \( y = (x - 2)^2 e^{x + 6} \). \( y' = 2(x - 2)e^{x + 6} + (x - 2)^2 e^{x + 6} = e^{x + 6}(x - 2)x \).  \nКритические точки: \( (x - 2)x = 0 \Rightarrow x = 0, 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -1 \): \( y' = (-1)(-3) > 0 \).  \n\( x = 1 \): \( y' = (1)(-1) < 0 \).  \n\( x = 3 \): \( y' = (3)(1) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n                0                  2\n```  \nВывод: При \( x = 0 \) производная меняется с \( + \) на \( - \), это минимум.",
        'answer' => '0'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = (x + 4)^2 (x - 2) + 6 \) на отрезке \( [-16; -3] \).',
        'solution' => "Производная: \( y' = 2(x + 4)(x - 2) + (x + 4)^2 = (x + 4)(3x - 2) \).  \nКритические точки: \( (x + 4)(3x - 2) = 0 \Rightarrow x = -4, \frac{2}{3} \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -5 \): \( y' = (-1)(-17) > 0 \).  \n\( x = 0 \): \( y' = (4)(-2) = -8 < 0 \).  \n\( x = 1 \): \( y' = (5)(1) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n               -4                0.67\n```  \nЗначения функции:  \n\( x = -16 \): \( y = 144(-18) + 6 = -2586 \).  \n\( x = -4 \): \( y = 0(-6) + 6 = 6 \).  \n\( x = -3 \): \( y = 1(-5) + 6 = 1 \). Максимум: 6.",
        'answer' => '6'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = (x - 2)^2 (x + 8) - 6 \) на отрезке \( [-4; 8] \).',
        'solution' => "Производная: \( y' = 2(x - 2)(x + 8) + (x - 2)^2 = (x - 2)(3x + 14) \).  \nКритические точки: \( (x - 2)(3x + 14) = 0 \Rightarrow x = 2, -\frac{14}{3} \approx -4.67 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -5 \): \( y' = (-7)(-1) > 0 \).  \n\( x = -4 \): \( y' = (-6)(2) < 0 \).  \n\( x = 3 \): \( y' = (1)(23) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n              -4.67                2\n```  \nЗначения функции:  \n\( x = -4 \): \( y = 36(4) - 6 = 138 \).  \n\( x = 2 \): \( y = 0(10) - 6 = -6 \).  \n\( x = 8 \): \( y = 36(16) - 6 = 570 \). Минимум: -6.",
        'answer' => '-6'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = (x - 12)(x - 14) + 2 \) на отрезке \( [10; 14] \).',
        'solution' => "Производная: \( y = x^2 - 26x + 170 \). \( y' = 2x - 26 \).  \nКритическая точка: \( 2x - 26 = 0 \Rightarrow x = 13 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 12 \): \( y' = 24 - 26 = -2 < 0 \).  \n\( x = 14 \): \( y' = 28 - 26 = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n               13\n```  \nЗначения функции:  \n\( x = 10 \): \( y = (10-12)(10-14) + 2 = 8 + 2 = 10 \).  \n\( x = 13 \): \( y = (13-12)(13-14) + 2 = -1 + 2 = 1 \).  \n\( x = 14 \): \( y = (14-12)(14-14) + 2 = 2 \). Максимум: 10.",
        'answer' => '10'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^2 - 4x + 3 \) на отрезке \( [-2; 5] \).',
        'solution' => "Производная: \( y' = 2x - 4 \).  \nКритическая точка: \( 2x - 4 = 0 \Rightarrow x = 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = -4 < 0 \).  \n\( x = 3 \): \( y' = 6 - 4 = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n                2\n```  \nЗначения функции:  \n\( x = -2 \): \( y = 4 + 8 + 3 = 15 \).  \n\( x = 2 \): \( y = 4 - 8 + 3 = -1 \).  \n\( x = 5 \): \( y = 25 - 20 + 3 = 8 \). Минимум: -1.",
        'answer' => '-1'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^2 - 10x + 24 \) на отрезке \( [1; 5] \).',
        'solution' => "Производная: \( y' = 2x - 10 \).  \nКритическая точка: \( 2x - 10 = 0 \Rightarrow x = 5 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 4 \): \( y' = 8 - 10 = -2 < 0 \).  \n\( x = 6 \): \( y' = 12 - 10 = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n                5\n```  \nЗначения функции:  \n\( x = 1 \): \( y = 1 - 10 + 24 = 15 \).  \n\( x = 5 \): \( y = 25 - 50 + 24 = -1 \). Минимум: -1.",
        'answer' => '-1'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^2 + 4x + 5 \) на отрезке \( [-6; 2] \).',
        'solution' => "Производная: \( y' = 2x + 4 \).  \nКритическая точка: \( 2x + 4 = 0 \Rightarrow x = -2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -3 \): \( y' = -6 + 4 = -2 < 0 \).  \n\( x = 0 \): \( y' = 4 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n               -2\n```  \nЗначения функции:  \n\( x = -6 \): \( y = 36 - 24 + 5 = 17 \).  \n\( x = -2 \): \( y = 4 - 8 + 5 = 1 \).  \n\( x = 2 \): \( y = 4 + 8 + 5 = 17 \). Минимум: 1.",
        'answer' => '1'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = \frac{x^2}{x + 50} \).',
        'solution' => "Производная: \( y' = \frac{2x(x + 50) - x^2 \cdot 1}{(x + 50)^2} = \frac{x(x + 100)}{(x + 50)^2} \).  \nКритические точки: \( x(x + 100) = 0 \Rightarrow x = 0, -100 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -150 \): \( y' = (-150)(-50) > 0 \).  \n\( x = -50 \): \( y' = (-50)(50) < 0 \).  \n\( x = 1 \): \( y' = (1)(101) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n              -100                0\n```  \nВывод: При \( x = 0 \) производная меняется с \( - \) на \( + \), это максимум.",
        'answer' => '0'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = \frac{x^2}{x + 90} \).',
        'solution' => "Производная: \( y' = \frac{2x(x + 90) - x^2 \cdot 1}{(x + 90)^2} = \frac{x(x + 180)}{(x + 90)^2} \).  \nКритические точки: \( x(x + 180) = 0 \Rightarrow x = 0, -180 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -200 \): \( y' = (-200)(-20) > 0 \).  \n\( x = -100 \): \( y' = (-100)(80) < 0 \).  \n\( x = 1 \): \( y' = (1)(181) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n              -180                0\n```  \nВывод: При \( x = 0 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '0'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = \frac{x^2 + 100}{x} \) на отрезке \( [-18; -2] \).',
        'solution' => "Производная: \( y = x + \frac{100}{x} \). \( y' = 1 - \frac{100}{x^2} \).  \nКритические точки: \( 1 - \frac{100}{x^2} = 0 \Rightarrow x^2 = 100 \Rightarrow x = \pm 10 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -20 \): \( y' = 1 - \frac{100}{400} = 0.75 > 0 \).  \n\( x = -5 \): \( y' = 1 - \frac{100}{25} = -3 < 0 \).  \n```\n   +                     -\n----------------*------------------*----------------> x\n              -10                10\n```  \nЗначения функции:  \n\( x = -18 \): \( y = -18 + \frac{100}{-18} \approx -23.56 \).  \n\( x = -10 \): \( y = -10 + \frac{100}{-10} = -20 \).  \n\( x = -2 \): \( y = -2 + \frac{100}{-2} = -52 \). Максимум: -20.",
        'answer' => '-20'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = \frac{x^2 + 4}{x} \) на отрезке \( [2; 9] \).',
        'solution' => "Производная: \( y = x + \frac{4}{x} \). \( y' = 1 - \frac{4}{x^2} \).  \nКритические точки: \( 1 - \frac{4}{x^2} = 0 \Rightarrow x^2 = 4 \Rightarrow x = \pm 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = 1 - 4 = -3 < 0 \).  \n\( x = 3 \): \( y' = 1 - \frac{4}{9} \approx 0.56 > 0 \).  \n```\n   -                     +\n----------------*------------------*----------------> x\n               -2                  2\n```  \nЗначения функции:  \n\( x = 2 \): \( y = 2 + \frac{4}{2} = 4 \).  \n\( x = 9 \): \( y = 9 + \frac{4}{9} \approx 9.44 \). Минимум: 4.",
        'answer' => '4'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = -x^2 + 2x \).',
        'solution' => "Производная: \( y' = -2x + 2 \).  \nКритическая точка: \( -2x + 2 = 0 \Rightarrow x = 1 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = 2 > 0 \).  \n\( x = 2 \): \( y' = -4 + 2 = -2 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n                1\n```  \nВывод: При \( x = 1 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '1'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = x^2 - 4x \).',
        'solution' => "Производная: \( y' = 2x - 4 \).  \nКритическая точка: \( 2x - 4 = 0 \Rightarrow x = 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = 2 - 4 = -2 < 0 \).  \n\( x = 3 \): \( y' = 6 - 4 = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n                2\n```  \nВывод: При \( x = 2 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '2'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = \ln(x - 1) - 4x + 12 \).',
        'solution' => "Производная: \( y' = \frac{1}{x - 1} - 4 \).  \nКритическая точка: \( \frac{1}{x - 1} - 4 = 0 \Rightarrow x - 1 = \frac{1}{4} \Rightarrow x = 1.25 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1.1 \): \( y' = \frac{1}{0.1} - 4 = 6 > 0 \).  \n\( x = 2 \): \( y' = \frac{1}{1} - 4 = -3 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n              1.25\n```  \nВывод: При \( x = 1.25 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '1.25'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = 5x - 3\ln(x + 4) + 2 \).',
        'solution' => "Производная: \( y' = 5 - \frac{3}{x + 4} \).  \nКритическая точка: \( 5 - \frac{3}{x + 4} = 0 \Rightarrow x + 4 = \frac{3}{5} \Rightarrow x = -3.4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -4 \): \( y' \), не определено, но близко отрицательно.  \n\( x = -3 \): \( y' = 5 - \frac{3}{1} = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n              -3.4\n```  \nВывод: При \( x = -3.4 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '-3.4'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = -3\ln(x - 6) - 5x + 9 \).',
        'solution' => "Производная: \( y' = -\frac{3}{x - 6} - 5 \).  \nКритическая точка: \( -\frac{3}{x - 6} - 5 = 0 \Rightarrow x - 6 = -\frac{3}{5} \Rightarrow x = 5.4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 5 \): \( y' = -\frac{3}{-1} - 5 = -2 < 0 \).  \n\( x = 6 \): \( y' \), не определено, но близко положительно.  \n```\n   -                     +\n----------------*----------------> x\n               5.4\n```  \nВывод: При \( x = 5.4 \) производная меняется с \( - \) на \( + \), это максимум.",
        'answer' => '5.4'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = -4x - \ln(x + 2) + 5 \).',
        'solution' => "Производная: \( y' = -4 - \frac{1}{x + 2} \).  \nКритическая точка: \( -4 - \frac{1}{x + 2} = 0 \Rightarrow x + 2 = -\frac{1}{4} \Rightarrow x = -2.25 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -3 \): \( y' = -4 - \frac{1}{-1} = -3 < 0 \).  \n\( x = -2 \): \( y' \), не определено, но близко положительно.  \n```\n   -                     +\n----------------*----------------> x\n              -2.25\n```  \nВывод: При \( x = -2.25 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '-2.25'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = \ln(x + 4) - x \) на отрезке \( [-3.5; 1] \).',
        'solution' => "Производная: \( y' = \frac{1}{x + 4} - 1 \).  \nКритическая точка: \( \frac{1}{x + 4} - 1 = 0 \Rightarrow x + 4 = 1 \Rightarrow x = -3 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -3.5 \): \( y' = \frac{1}{0.5} - 1 = 1 > 0 \).  \n\( x = -2 \): \( y' = \frac{1}{2} - 1 = -0.5 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n               -3\n```  \nЗначения функции:  \n\( x = -3.5 \): \( y = \ln(0.5) + 3.5 \approx 2.807 \).  \n\( x = -3 \): \( y = \ln(1) + 3 = 3 \).  \n\( x = 1 \): \( y = \ln(5) - 1 \approx 0.609 \). Максимум: 3.",
        'answer' => '3'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x - \ln(x + 7) + 2 \) на отрезке \( [-6.5; 1] \).',
        'solution' => "Производная: \( y' = 1 - \frac{1}{x + 7} \).  \nКритическая точка: \( 1 - \frac{1}{x + 7} = 0 \Rightarrow x + 7 = 1 \Rightarrow x = -6 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -6.5 \): \( y' = 1 - \frac{1}{0.5} = -1 < 0 \).  \n\( x = -5 \): \( y' = 1 - \frac{1}{2} = 0.5 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n               -6\n```  \nЗначения функции:  \n\( x = -6.5 \): \( y = -6.5 - \ln(0.5) + 2 \approx -3.807 \).  \n\( x = -6 \): \( y = -6 - \ln(1) + 2 = -4 \).  \n\( x = 1 \): \( y = 1 - \ln(8) + 2 \approx 0.921 \). Минимум: -4.",
        'answer' => '-4'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = -x^2 - x + 3 \) на отрезке \( [0; 1] \).',
        'solution' => "Производная: \( y' = -2x - 1 \).  \nКритическая точка: \( -2x - 1 = 0 \Rightarrow x = -0.5 \), вне отрезка.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = -1 < 0 \).  \n\( x = 1 \): \( y' = -3 < 0 \).  \n```\n   -\n----------------*----------------> x\n              -0.5\n```  \nЗначения функции:  \n\( x = 0 \): \( y = 3 \).  \n\( x = 1 \): \( y = -1 - 1 + 3 = 1 \). Максимум: 3.",
        'answer' => '3'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^2 - 2x + 2 \) на отрезке \( [0; 1] \).',
        'solution' => "Производная: \( y' = 2x - 2 \).  \nКритическая точка: \( 2x - 2 = 0 \Rightarrow x = 1 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = -2 < 0 \).  \n\( x = 2 \): \( y' = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n                1\n```  \nЗначения функции:  \n\( x = 0 \): \( y = 2 \).  \n\( x = 1 \): \( y = 1 - 2 + 2 = 1 \). Минимум: 1.",
        'answer' => '1'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = -x^2 + 2x + 1 \) на отрезке \( [-1; 2] \).',
        'solution' => "Производная: \( y' = -2x + 2 \).  \nКритическая точка: \( -2x + 2 = 0 \Rightarrow x = 1 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = 2 > 0 \).  \n\( x = 2 \): \( y' = -2 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n                1\n```  \nЗначения функции:  \n\( x = -1 \): \( y = -1 + 2 + 1 = 2 \).  \n\( x = 1 \): \( y = -1 + 2 + 1 = 2 \).  \n\( x = 2 \): \( y = -4 + 4 + 1 = 1 \). Максимум: 2.",
        'answer' => '2'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = 10x - \ln(x + 11) \) на отрезке \( [-10.5; 1] \).',
        'solution' => "Производная: \( y' = 10 - \frac{1}{x + 11} \).  \nКритическая точка: \( 10 - \frac{1}{x + 11} = 0 \Rightarrow x + 11 = \frac{1}{10} \Rightarrow x = -10.9 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -11 \): \( y' \), не определено, но близко отрицательно.  \n\( x = -10 \): \( y' = 10 - \frac{1}{1} = 9 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n              -10.9\n```  \nЗначения функции:  \n\( x = -10.5 \): \( y = -105 - \ln(0.5) \approx -104.307 \).  \n\( x = 1 \): \( y = 10 - \ln(12) \approx 7.515 \). Минимум: -104.",
        'answer' => '-104'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^2 - 2x - 3 \) на отрезке \( [0; 3] \).',
        'solution' => "Производная: \( y' = 2x - 2 \).  \nКритическая точка: \( 2x - 2 = 0 \Rightarrow x = 1 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = -2 < 0 \).  \n\( x = 2 \): \( y' = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n                1\n```  \nЗначения функции:  \n\( x = 0 \): \( y = -3 \).  \n\( x = 1 \): \( y = 1 - 2 - 3 = -4 \).  \n\( x = 3 \): \( y = 9 - 6 - 3 = 0 \). Минимум: -4.",
        'answer' => '-4'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = (x - 2)\cos(x) - \sin(x) + 5 \) на \( (0; 2\pi) \).',
        'solution' => "Производная: \( y' = \cos(x) + (x - 2)(-\sin(x)) - \cos(x) = -(x - 2)\sin(x) \).  \nКритические точки: \( -(x - 2)\sin(x) = 0 \Rightarrow x = 2 \) или \( \sin(x) = 0 \Rightarrow x = \pi, 2\pi \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = -(1-2)\sin(1) > 0 \).  \n\( x = 2.5 \): \( y' = -(2.5-2)\sin(2.5) < 0 \).  \n\( x = 4 \): \( y' = -(4-2)\sin(4) > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n                2                  π\n```  \nВывод: При \( x = 2 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '2'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = (x - 2)\cos(x) \).',
        'solution' => "Производная: \( y' = \cos(x) - (x - 2)\sin(x) \).  \nКритическая точка: Численно: \( x \approx 2 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = \cos(1) + \sin(1) \approx 1.38 > 0 \).  \n\( x = 3 \): \( y' = \cos(3) - \sin(3) \approx -1.13 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n                2\n```  \nВывод: При \( x = 2 \) производная меняется с \( + \) на \( - \), это минимум.",
        'answer' => '2'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = 6x - 3\sin(x) + 6 \) на отрезке \( [-\frac{\pi}{2}; 0] \).',
        'solution' => "Производная: \( y' = 6 - 3\cos(x) \).  \nКритические точки: \( 6 - 3\cos(x) = 0 \Rightarrow \cos(x) = 2 \), корней нет.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -\frac{\pi}{2} \): \( y' = 6 > 0 \).  \n\( x = 0 \): \( y' = 3 > 0 \).  \n```\n   +\n----------------*----------------> x\n```  \nЗначения функции:  \n\( x = -\frac{\pi}{2} \): \( y \approx -9.424 + 3 + 6 = -0.424 \).  \n\( x = 0 \): \( y = 6 \). Максимум: 6.",
        'answer' => '6'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = 18\sin(x) - 20x + 22 \) на отрезке \( [-\frac{\pi}{2}; 0] \).',
        'solution' => "Производная: \( y' = 18\cos(x) - 20 \).  \nКритические точки: \( \cos(x) = \frac{20}{18} \), корней нет.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -\frac{\pi}{2} \): \( y' = -20 < 0 \).  \n\( x = 0 \): \( y' = -2 < 0 \).  \n```\n   -\n----------------*----------------> x\n```  \nЗначения функции:  \n\( x = -\frac{\pi}{2} \): \( y \approx -18 + 31.416 + 22 \approx 35.416 \).  \n\( x = 0 \): \( y = 22 \). Минимум: 22.",
        'answer' => '22'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = 15\cos(x) - 18x - 30 \) на отрезке \( [-\frac{\pi}{2}; 0] \).',
        'solution' => "Производная: \( y' = -15\sin(x) - 18 \).  \nКритические точки: \( -15\sin(x) - 18 = 0 \), корней нет.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -\frac{\pi}{2} \): \( y' = 15 - 18 = -3 < 0 \).  \n\( x = 0 \): \( y' = -18 < 0 \).  \n```\n   -\n----------------*----------------> x\n```  \nЗначения функции:  \n\( x = -\frac{\pi}{2} \): \( y \approx 28.274 - 30 \approx -1.726 \).  \n\( x = 0 \): \( y = -15 \). Минимум: -15.",
        'answer' => '-15'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = \sin(x) + 2 \) на отрезке \( [-\frac{\pi}{2}; 0] \).',
        'solution' => "Производная: \( y' = \cos(x) \).  \nКритическая точка: \( \cos(x) = 0 \Rightarrow x = -\frac{\pi}{2} \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -\frac{\pi}{2} \): \( y' = 0 \).  \n\( x = 0 \): \( y' = 1 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n              -π/2\n```  \nЗначения функции:  \n\( x = -\frac{\pi}{2} \): \( y = -1 + 2 = 1 \).  \n\( x = 0 \): \( y = 0 + 2 = 2 \). Максимум: 2.",
        'answer' => '2'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = 4\cos(x + \frac{\pi}{12}) + 8 \) на отрезке \( [-\frac{2\pi}{3}; 0] \).',
        'solution' => "Производная: \( y' = -4\sin(x + \frac{\pi}{12}) \).  \nКритические точки: \( \sin(x + \frac{\pi}{12}) = 0 \Rightarrow x + \frac{\pi}{12} = \pi \Rightarrow x = \frac{11\pi}{12} \), вне отрезка.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -\frac{2\pi}{3} \): \( y' \approx -4(-0.966) > 0 \).  \n\( x = 0 \): \( y' \approx -4(0.259) < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n```  \nЗначения функции:  \n\( x = -\frac{2\pi}{3} \): \( y \approx 6.964 \).  \n\( x = 0 \): \( y \approx 11.864 \). Минимум: 7.",
        'answer' => '7'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = 7 - 7\tan(x) - 2 \) на отрезке \( [0; \frac{\pi}{4}] \).',
        'solution' => "Производная: \( y' = -7\sec^2(x) \).  \nКритические точки: \( \sec^2(x) \neq 0 \), корней нет.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = -7 < 0 \).  \n\( x = \frac{\pi}{4} \): \( y' = -14 < 0 \).  \n```\n   -\n----------------*----------------> x\n```  \nЗначения функции:  \n\( x = 0 \): \( y = 5 \).  \n\( x = \frac{\pi}{4} \): \( y = -2 \). Максимум: 5.",
        'answer' => '5'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = 20 - 20\tan(x) + 36 \) на отрезке \( [-\frac{\pi}{4}; 0] \).',
        'solution' => "Производная: \( y' = -20\sec^2(x) \).  \nКритические точки: \( \sec^2(x) \neq 0 \), корней нет.  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = -\frac{\pi}{4} \): \( y' = -40 < 0 \).  \n\( x = 0 \): \( y' = -20 < 0 \).  \n```\n   -\n----------------*----------------> x\n```  \nЗначения функции:  \n\( x = -\frac{\pi}{4} \): \( y = 76 \).  \n\( x = 0 \): \( y = 56 \). Минимум: 56.",
        'answer' => '56'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = -x^2 + 3x + 5 \) на отрезке \( [-1; 2] \).',
        'solution' => "Производная: \( y' = -2x + 3 \).  \nКритическая точка: \( -2x + 3 = 0 \Rightarrow x = 1.5 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = 3 > 0 \).  \n\( x = 2 \): \( y' = -1 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n               1.5\n```  \nЗначения функции:  \n\( x = -1 \): \( y = -1 + 3 + 5 = 7 \).  \n\( x = 1.5 \): \( y = -2.25 + 4.5 + 5 = 7.25 \).  \n\( x = 2 \): \( y = -4 + 6 + 5 = 7 \). Максимум: 7.25.",
        'answer' => '7.25'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^2 - 6x + 10 \) на отрезке \( [1; 4] \).',
        'solution' => "Производная: \( y' = 2x - 6 \).  \nКритическая точка: \( 2x - 6 = 0 \Rightarrow x = 3 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 2 \): \( y' = -2 < 0 \).  \n\( x = 4 \): \( y' = 2 > 0 \).  \n```\n   -                     +\n----------------*----------------> x\n                3\n```  \nЗначения функции:  \n\( x = 1 \): \( y = 5 \).  \n\( x = 3 \): \( y = 1 \).  \n\( x = 4 \): \( y = 2 \). Минимум: 1.",
        'answer' => '1'
    ],
    [
        'problem' => 'Найдите точку максимума функции \( y = -x^2 + 8x - 12 \).',
        'solution' => "Производная: \( y' = -2x + 8 \).  \nКритическая точка: \( -2x + 8 = 0 \Rightarrow x = 4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 3 \): \( y' = 2 > 0 \).  \n\( x = 5 \): \( y' = -2 < 0 \).  \n```\n   +                     -\n----------------*----------------> x\n                4\n```  \nВывод: При \( x = 4 \) производная меняется с \( + \) на \( - \), это максимум.",
        'answer' => '4'
    ],
    [
        'problem' => 'Найдите наибольшее значение функции \( y = -x^3 + 12x^2 - 36x + 5 \) на отрезке \( [0; 5] \).',
        'solution' => "Производная: \( y' = -3x^2 + 24x - 36 \).  \nКритические точки: \( x^2 - 8x + 12 = 0 \). \( D = 16 \). \( x = 2, 6 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = -15 < 0 \).  \n\( x = 3 \): \( y' = 9 > 0 \).  \n\( x = 5 \): \( y' = 9 > 0 \).  \n```\n   -                     +                    +\n----------------*------------------*----------------> x\n                2                  6\n```  \nЗначения функции:  \n\( x = 0 \): \( y = 5 \).  \n\( x = 2 \): \( y = -27 \).  \n\( x = 5 \): \( y = 0 \). Максимум: 5.",
        'answer' => '5'
    ],
    [
        'problem' => 'Найдите точку минимума функции \( y = x^3 - 9x^2 + 24x - 10 \).',
        'solution' => "Производная: \( y' = 3x^2 - 18x + 24 \).  \nКритические точки: \( x^2 - 6x + 8 = 0 \). \( D = 4 \). \( x = 2, 4 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 1 \): \( y' = 9 > 0 \).  \n\( x = 3 \): \( y' = -3 < 0 \).  \n\( x = 5 \): \( y' = 9 > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n                2                  4\n```  \nВывод: При \( x = 4 \) производная меняется с \( - \) на \( + \), это минимум.",
        'answer' => '4'
    ],
    [
        'problem' => 'Найдите наименьшее значение функции \( y = x^3 - 6x^2 + 9x + 1 \) на отрезке \( [-1; 4] \).',
        'solution' => "Производная: \( y' = 3x^2 - 12x + 9 \).  \nКритические точки: \( x^2 - 4x + 3 = 0 \). \( D = 4 \). \( x = 1, 3 \).  \nЗнаковая диаграмма: Тестовые точки:  \n\( x = 0 \): \( y' = 9 > 0 \).  \n\( x = 2 \): \( y' = -3 < 0 \).  \n\( x = 4 \): \( y' = 9 > 0 \).  \n```\n   +                     -                    +\n----------------*------------------*----------------> x\n                1                  3\n```  \nЗначения функции:  \n\( x = -1 \): \( y = -3 \).  \n\( x = 1 \): \( y = 5 \).  \n\( x = 3 \): \( y = 1 \).  \n\( x = 4 \): \( y = 5 \). Минимум: -3.",
        'answer' => '-3'
    ]
];

// Обновляем существующие задачи в базе данных (для всех задач)
try {
    // Очищаем поля от невидимых символов
    $stmt = $db->prepare("UPDATE tasks_app_task SET problem = REGEXP_REPLACE(problem, '[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]', ''), solution = REGEXP_REPLACE(solution, '[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]', ''), answer = REGEXP_REPLACE(answer, '[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]', '')");
    $stmt->execute();
    echo "Существующие задачи очищены от невидимых символов.<br>";

    // Форматируем знаковые диаграммы
    $stmt = $db->prepare("UPDATE tasks_app_task SET solution = REPLACE(solution, '> x', '\( \rightarrow \) x')");
    $stmt->execute();
    echo "Знаковые диаграммы во всех задачах отформатированы.<br>";
} catch (PDOException $e) {
    die("Ошибка при обновлении задач: " . $e->getMessage());
}

// Удаляем существующие задачи с number = 12
try {
    $stmt = $db->prepare('DELETE FROM tasks_app_task WHERE number = ?');
    $stmt->execute([12]);
    echo "Существующие задачи с number = 12 удалены.<br>";
} catch (PDOException $e) {
    die("Ошибка при удалении задач: " . $e->getMessage());
}

// Вставляем восстановленные задачи
try {
    $stmt = $db->prepare('INSERT INTO tasks_app_task (number, task_number, problem, image, solution, answer) VALUES (?, ?, ?, ?, ?, ?)');
    foreach ($tasks as $index => $task) {
        $task_number = $index + 1; // task_number от 1 до 54
        // Очищаем текст от невидимых символов
        $cleaned_problem = cleanText($task['problem']);
        $cleaned_solution = cleanText($task['solution']);
        $cleaned_answer = cleanText($task['answer']);
        // Форматируем знаковую диаграмму
        $formatted_solution = formatSignDiagram($cleaned_solution);
        // Логируем данные перед вставкой для отладки
        error_log("Inserting task $task_number: problem = " . substr($cleaned_problem, 0, 50) . "...");
        $stmt->execute([
            12, // number = 12
            $task_number,
            $cleaned_problem,
            null, // Поле image = NULL
            $formatted_solution,
            $cleaned_answer
        ]);
        echo "Задача $task_number для number = 12 восстановлена.<br>";
    }
    echo "Все задачи успешно восстановлены!";
} catch (PDOException $e) {
    // Логируем ошибку для отладки
    error_log("Ошибка при вставке задачи: " . $e->getMessage());
    die("Ошибка при восстановлении задач: " . $e->getMessage());
}
?>
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Восстановление задач - PixelMath</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        a {
            color: #007bff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <p><a href="<?php echo ADMIN_PATH; ?>/admin.php">Вернуться в админку</a></p>
</body>
</html>